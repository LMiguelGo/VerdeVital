\doxysection{ESPNow\+Receiver.\+h}
\hypertarget{_p_f-_edge_2include_2_e_s_p_now_receiver_8h_source}{}\label{_p_f-_edge_2include_2_e_s_p_now_receiver_8h_source}\index{PF-\/Edge/include/ESPNowReceiver.h@{PF-\/Edge/include/ESPNowReceiver.h}}
\mbox{\hyperlink{_p_f-_edge_2include_2_e_s_p_now_receiver_8h}{Ir a la documentaci√≥n de este archivo.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#ifndef\ ESP\_NOW\_RECEIVER\_H}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#define\ ESP\_NOW\_RECEIVER\_H}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{comment}{//\ Librer√≠as}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <WiFi.h>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <esp\_now.h>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <esp\_wifi.h>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{data_sensor_8h}{dataSensor.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00022\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_e_s_p_now_receiver_ad13938255b12dce853fb8d8b89ef9bde}{ESPNowReceiver}}\ \{}
\DoxyCodeLine{00023\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00024\ \ \ \ \ uint8\_t\ \_channel;\ }
\DoxyCodeLine{00025\ \ \ \ \ void\ (*\_onReceiveCallback)(\textcolor{keyword}{const}\ \mbox{\hyperlink{struct_sensor_data}{SensorData}}\&);\ }
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{class_e_s_p_now_receiver_ad13938255b12dce853fb8d8b89ef9bde}{ESPNowReceiver}}*\ \_instance;\ }
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ TIMEOUT\_MS\ =\ 10000;\ }
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \_lastReceivedTime\ =\ 0;\ }
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{keywordtype}{bool}\ \_connected\ =\ \textcolor{keyword}{false};\ }
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00037\ \ \ \ \ \mbox{\hyperlink{class_e_s_p_now_receiver_ad13938255b12dce853fb8d8b89ef9bde}{ESPNowReceiver}}(uint8\_t\ channel\ =\ 1)\ :\ \_channel(channel),\ \_onReceiveCallback(nullptr)\ \{\}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_e_s_p_now_receiver_a73b845142d85067cd73239f44d569cc7}{begin}}()\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ WiFi.mode(WIFI\_STA);}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ esp\_wifi\_set\_channel(\_channel,\ WIFI\_SECOND\_CHAN\_NONE);}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (esp\_now\_init()\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}‚ùå\ Error\ al\ iniciar\ ESP-\/NOW"{}});}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ esp\_now\_register\_recv\_cb([](\textcolor{keyword}{const}\ uint8\_t\ *mac,\ \textcolor{keyword}{const}\ uint8\_t\ *incomingDataRaw,\ \textcolor{keywordtype}{int}\ len)\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_sensor_data}{SensorData}}\ data;}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ memcpy(\&data,\ incomingDataRaw,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_sensor_data}{SensorData}}));}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_instance)\ \{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_instance-\/>\_lastReceivedTime\ =\ millis();}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_instance-\/>\_connected)\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}üîÑ\ Nodo\ conectado\ nuevamente"{}});}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_instance-\/>\_connected\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_instance-\/>\_onReceiveCallback)\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_instance-\/>\_onReceiveCallback(data);}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \_instance\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}‚úÖ\ ESP-\/NOW\ Receptor\ listo"{}});}
\DoxyCodeLine{00073\ \ \ \ \ \}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_e_s_p_now_receiver_a71e6dd964656d036d1c38611377bc7a1}{onReceive}}(\textcolor{keywordtype}{void}\ (*callback)(\textcolor{keyword}{const}\ \mbox{\hyperlink{struct_sensor_data}{SensorData}}\&))\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \_onReceiveCallback\ =\ callback;}
\DoxyCodeLine{00081\ \ \ \ \ \}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_e_s_p_now_receiver_a5e2469ce3050943fbc9cf8888a5430f6}{update}}()\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_connected\ \&\&\ millis()\ -\/\ \_lastReceivedTime\ >\ TIMEOUT\_MS)\ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \_connected\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}‚ö†Ô∏è\ Nodo\ inactivo\ (timeout)"{}});}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00093\ \ \ \ \ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_e_s_p_now_receiver_a91f87802204670f9236bb689f999b1c3}{isConnected}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_connected;}
\DoxyCodeLine{00101\ \ \ \ \ \}}
\DoxyCodeLine{00102\ \};}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \mbox{\hyperlink{class_e_s_p_now_receiver}{ESPNowReceiver}}*\ ESPNowReceiver::\_instance\ =\ \textcolor{keyword}{nullptr};\ }
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ ESP\_NOW\_RECEIVER\_H}}

\end{DoxyCode}
