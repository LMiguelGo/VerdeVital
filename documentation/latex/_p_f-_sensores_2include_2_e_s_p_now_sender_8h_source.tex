\doxysection{ESPNow\+Sender.\+h}
\hypertarget{_p_f-_sensores_2include_2_e_s_p_now_sender_8h_source}{}\label{_p_f-_sensores_2include_2_e_s_p_now_sender_8h_source}\index{PF-\/Sensores/include/ESPNowSender.h@{PF-\/Sensores/include/ESPNowSender.h}}
\mbox{\hyperlink{_p_f-_sensores_2include_2_e_s_p_now_sender_8h}{Ir a la documentaci√≥n de este archivo.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#ifndef\ ESP\_NOW\_SENDER\_H}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#define\ ESP\_NOW\_SENDER\_H}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{comment}{//\ Librer√≠as}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <WiFi.h>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <esp\_now.h>}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <esp\_wifi.h>}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sensor_data_8h}{sensorData.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{comment}{//\ Estructura\ que\ se\ enviar√°\ por\ ESP-\/NOW\ (id√©ntica\ a\ SensorData)}}
\DoxyCodeLine{00020\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{struct_sensor_data}{SensorData}}\ \mbox{\hyperlink{_p_f-_sensores_2include_2_e_s_p_now_sender_8h_ad84dc0f9f050dea47380736f459fbbd8}{struct\_message}};}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00029\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_e_s_p_now_sender_a0c1ce669b47d6005144150588e8e9312}{ESPNowSender}}\ \{}
\DoxyCodeLine{00030\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00031\ \ \ \ \ uint8\_t\ \_peerAddress[6];\ }
\DoxyCodeLine{00032\ \ \ \ \ uint8\_t\ \_channel;\ }
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00040\ \ \ \ \ \mbox{\hyperlink{class_e_s_p_now_sender_a0c1ce669b47d6005144150588e8e9312}{ESPNowSender}}(\textcolor{keyword}{const}\ uint8\_t\ mac[6],\ uint8\_t\ channel)\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ memcpy(\_peerAddress,\ mac,\ 6);}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \_channel\ =\ channel;}
\DoxyCodeLine{00043\ \ \ \ \ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_e_s_p_now_sender_a172f017d86833cfec51c809fa866931e}{begin}}()\ \{}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ WiFi.mode(WIFI\_STA);}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ esp\_wifi\_set\_channel(\_channel,\ WIFI\_SECOND\_CHAN\_NONE);}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (esp\_now\_init()\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}‚ùå\ Error\ al\ iniciar\ ESP-\/NOW"{}});}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ esp\_now\_register\_send\_cb([](\textcolor{keyword}{const}\ uint8\_t\ *mac\_addr,\ esp\_now\_send\_status\_t\ status)\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(\textcolor{stringliteral}{"{}üì§\ Estado\ del\ env√≠o:\ "{}});}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(status\ ==\ ESP\_NOW\_SEND\_SUCCESS\ ?\ \textcolor{stringliteral}{"{}√âxito"{}}\ :\ \textcolor{stringliteral}{"{}Fallo"{}});}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ esp\_now\_peer\_info\_t\ peerInfo\ =\ \{\};}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ memcpy(peerInfo.peer\_addr,\ \_peerAddress,\ 6);}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ peerInfo.channel\ =\ \_channel;}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ peerInfo.encrypt\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ peerInfo.ifidx\ =\ WIFI\_IF\_STA;}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!esp\_now\_is\_peer\_exist(\_peerAddress))\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (esp\_now\_add\_peer(\&peerInfo)\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}‚ùå\ Error\ al\ a√±adir\ el\ peer"{}});}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}‚úÖ\ ESP-\/NOW\ Emisor\ listo"{}});}
\DoxyCodeLine{00078\ \ \ \ \ \}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_e_s_p_now_sender_ab52764ebf869b2c7fc36f33448205a5f}{sendData}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{struct_sensor_data}{SensorData}}\&\ data)\ \{}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ esp\_err\_t\ result\ =\ esp\_now\_send(\_peerAddress,\ (uint8\_t\ *)\&data,\ \textcolor{keyword}{sizeof}(data));}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}üì®\ Datos\ enviados\ correctamente"{}});}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(\textcolor{stringliteral}{"{}‚ö†Ô∏è\ Error\ al\ enviar\ datos:\ "{}});}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(esp\_err\_to\_name(result));}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00092\ \ \ \ \ \}}
\DoxyCodeLine{00093\ \};}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ ESP\_NOW\_SENDER\_H}}

\end{DoxyCode}
